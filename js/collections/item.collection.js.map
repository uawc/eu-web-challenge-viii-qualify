{"version":3,"sources":["..\\..\\..\\src\\js\\collections\\item.collection.js"],"names":[],"mappings":";;AAAA,MAAM,CAAC,CAAC,YAAY,EAAE,UAAU,EAAE,mBAAmB,CAAC,EACrD,UAAC,CAAC,EAAE,QAAQ,EAAE,SAAS,EAAI;;AAE1B,KAAI,eAAe,GAAG,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC;;AAEhD,OAAK,EAAE,SAAS;;;;;;;AAOhB,OAAK,EAAA,eAAC,IAAI,EAAE;AACX,OAAI,CAAC,KAAK,EAAE,CAAC;AACb,OAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;GAC3B;;;;;;;;AAQD,aAAW,EAAA,qBAAC,YAAY,EAAE,MAAM,EAAE;AACjC,OAAI,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAC,EAAE,EAAG;AACtC,QAAI,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;AAC5F,OAAE,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;KAC3B;IACD,CAAC,CAAC;;AAEH,OAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;GACnB;;;;;;;;AAQD,cAAY,EAAA,sBAAC,IAAI,EAAE;AAClB,IAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAC,EAAE,EAAG;AAClB,QAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAC,OAAO,CAAC,EAAE;AAChE,WAAM,EAAC,aAAa,EAAE,mBAAmB,EAAC,CAAC;KAC3C;IACD,CAAC,CAAC;;AAEH,UAAO,IAAI,CAAC;GACZ;;;;;;;;AAQD,OAAK,EAAA,eAAC,IAAI,EAAE;;;AACX,OAAI,EAAE,GAAG,CAAC;OACT,KAAK,GAAG,EAAE;OACV,MAAM,GAAG,EAAE;OACX,MAAM,GAAG,GAAG,CAAC;;AAEd,OAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;;AAE5B,IAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAC,OAAO,EAAG;AACvB,QAAI,UAAU,GAAG,MAAK,mBAAmB,CAAC,OAAO,CAAC,CAAC;;AAEnD,UAAK,qBAAqB,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;AAC9C,UAAK,iBAAiB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,CAAC,CAAC;;AAEtD,QAAG,CAAC,UAAU,CAAC,QAAQ,EAAE,MAAM,IAAI,EAAE,CAAC;AACtC,MAAE,EAAE,CAAC;;AAEL,UAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrB,SAAK,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;IAC7B,CAAC,CAAC;;AAEH,UAAO,MAAM,CAAC;GACd;;;;;;;;AAQD,WAAS,EAAA,mBAAC,IAAI,EAAE;AACf,UAAQ,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;GAC/B;;;;;;;;AAQD,qBAAmB,EAAA,6BAAC,OAAO,EAAE;AAC5B,UAAO,OAAO,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,GAAG,OAAO,CAAC;GACzD;;;;;;;;AAQD,uBAAqB,EAAA,+BAAC,KAAK,EAAE,UAAU,EAAE;AACxC,OAAI,KAAK,CAAC,MAAM,EAAE;AACjB,WAAO,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,UAAU,CAAC,KAAK,EAAE;AAClD,UAAK,CAAC,GAAG,EAAE,CAAC;KACZ;IACD;GACD;;;;;;;;;;AAUD,mBAAiB,EAAA,2BAAC,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,EAAC;AAC/C,IAAC,CAAC,MAAM,CAAC,UAAU,EAAE;AACpB,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,UAAU,CAAC,IAAI;AAChD,KAAC,EAAE,MAAM;AACT,MAAE,EAAE,EAAE;IACN,CAAC,CAAC;GACH;EACD,CAAC,CAAC;;AAEH,QAAO,IAAI,eAAe,EAAE,CAAC;CAC7B,CAAC,CAAC","file":"item.collection.js","sourcesContent":["define(['underscore', 'backbone', 'models/item.model'],\r\n\t(_, Backbone, ItemModel)=> {\r\n\r\n\t\tlet ItemsCollection = Backbone.Collection.extend({\r\n\t\t\t// Reference to this collection's model.\r\n\t\t\tmodel: ItemModel,\r\n\r\n\t\t\t/**\r\n\t\t\t * Overriding fetch method\r\n\t\t\t * @public\r\n\t\t\t * @param data - {array}\r\n\t\t\t * */\r\n\t\t\tfetch(data) {\r\n\t\t\t\tthis.reset();\r\n\t\t\t\tthis.add(this.parse(data));\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Toggling models visibility attribute\r\n\t\t\t * @public\r\n\t\t\t * @param currentModel - {model}\r\n\t\t\t * @param isHide - {boolean}\r\n\t\t\t * */\r\n\t\t\ttoggleNodes(currentModel, isHide) {\r\n\t\t\t\tlet models = _.each(this.models, (el)=>{\r\n\t\t\t\t\tif (currentModel.get('right') > el.get('left') && el.get('left') > currentModel.get('left')) {\r\n\t\t\t\t\t\tel.set('isHidden', isHide);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.fetch(models);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Validating of input data format\r\n\t\t\t * @public\r\n\t\t\t * @param data - {array}\r\n\t\t\t * @return data - {array}\r\n\t\t\t * */\r\n\t\t\tvalidateData(data) {\r\n\t\t\t\t_.each(data, (el)=>{\r\n\t\t\t\t\tif(!_.has(el,'name') || !_.has(el,'left') || !_.has(el,'right')) {\r\n\t\t\t\t\t\tthrow {customMessage: 'Wrong data format'};\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn data;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Parsing data and generating traversal tree\r\n\t\t\t * @public\r\n\t\t\t * @param data - {array}\r\n\t\t\t * @return {array}\r\n\t\t\t * */\r\n\t\t\tparse(data) {\r\n\t\t\t\tlet id = 0,\r\n\t\t\t\t\tright = [],\r\n\t\t\t\t\tmodels = [],\r\n\t\t\t\t\toffset = 100;\r\n\r\n\t\t\t\tdata = this._sortData(data);\r\n\r\n\t\t\t\t_.each(data, (element)=>{\r\n\t\t\t\t\tlet attributes = this._getModelAttributes(element);\r\n\r\n\t\t\t\t\tthis._removeRightFromStack(right, attributes);\r\n\t\t\t\t\tthis._extendAttributes(attributes, right, offset, id);\r\n\r\n\t\t\t\t\tif(!attributes.isHidden) offset += 35;\r\n\t\t\t\t\tid++;\r\n\r\n\t\t\t\t\tmodels.push(element);\r\n\t\t\t\t\tright.push(attributes.right);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn models;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Sorting data by \"left\" key\r\n\t\t\t * @private\r\n\t\t\t * @param data - {array}\r\n\t\t\t * @return {array}\r\n\t\t\t * */\r\n\t\t\t_sortData(data) {\r\n\t\t\t\treturn  _.sortBy(data, 'left');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Checking if object a model and returning proper attributes\r\n\t\t\t * @private\r\n\t\t\t * @param element - {model || object}\r\n\t\t\t * @return {object}\r\n\t\t\t * */\r\n\t\t\t_getModelAttributes(element) {\r\n\t\t\t\treturn element.attributes ? element.attributes : element;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Removing right value from the stack\r\n\t\t\t * @private\r\n\t\t\t * @param right - {array}\r\n\t\t\t * @param attributes - {object}\r\n\t\t\t * */\r\n\t\t\t_removeRightFromStack(right, attributes) {\r\n\t\t\t\tif (right.length) {\r\n\t\t\t\t\twhile (right[right.length - 1] < attributes.right) {\r\n\t\t\t\t\t\tright.pop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Extending attributes with data\r\n\t\t\t * @private\r\n\t\t\t * @param attributes - {object}\r\n\t\t\t * @param right - {array}\r\n\t\t\t * @param offset - {number}\r\n\t\t\t * @param id - {number}\r\n\t\t\t * */\r\n\t\t\t_extendAttributes(attributes, right, offset, id){\r\n\t\t\t\t_.extend(attributes, {\r\n\t\t\t\t\ttext: '-'.repeat(right.length) + attributes.name,\r\n\t\t\t\t\ty: offset,\r\n\t\t\t\t\tid: id\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn new ItemsCollection();\r\n\t});"]}